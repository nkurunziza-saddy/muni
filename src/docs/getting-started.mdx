---
outline: deep
---

# Shiki Transformers — Demo & Guide

A practical MDX page that shows the **transformers** from `@shikijs/transformers` when used via `@shikijs/rehype`. Includes copy-paste examples (MDX snippets), expected HTML output, CSS you can drop into Tailwind, and troubleshooting steps.

---

## Quick summary (TL;DR)

- **If your transformers "don't work"**: 90% chance the notation is escaped by remark/MDX or you haven't added styles. Use `transformerRemoveNotationEscape()` and add CSS for the classes the transformers add.
- Use `matchAlgorithm: 'v3'` for more intuitive single-line comment matching.
- Transformers only add classes — **you must style them**.

---

## Rehype config (what to use in `vite.config.ts` / MDX pipeline)

```ts
// Example snippet to use inside your mdx rehypePlugins array
import { transformerRemoveNotationEscape } from "@shikijs/transformers";

[
  rehypeShiki,
  {
    themes: { dark: "vitesse-dark", light: "vitesse-light" },
    defaultColor: "light",
    transformers: [
      // Must be first if your MDX escapes notations
      transformerRemoveNotationEscape(),

      // Housekeeping and helpers (example order)
      transformerLineNumbers(),

      // Notation transformers (force v3 for better single-line semantics)
      transformerNotationDiff({ matchAlgorithm: "v3" }),
      transformerNotationFocus({ matchAlgorithm: "v3" }),
      transformerNotationHighlight({ matchAlgorithm: "v3" }),
      transformerNotationWordHighlight(),

      // Project-specific helpers
      transformerNotationInclude({ rootDir: path.resolve(__dirname, "./src") }),
      transformerEmptyLine(),
      transformerTagLine(),
      transformerTitle(),
      transformerSplitIdentifiers(),
    ],
  },
];
```

> Put `transformerRemoveNotationEscape()` **first** (or very early). If you have custom transformers that rely on the unescaped `// [!code ...]` notation, they will fail unless the escape transformer runs.

---

## Transformers i used

### 1) Diff notation — `++` (added) and `--` (removed)

````mdx
```js
console.log("old"); // [!code --]
console.log("new"); // [!code ++]
console.log("same");
```
````

**What it does**: marks lines as added/removed via classes `diff add` and `diff remove` on the line `<span>`s and adds `has-diff` to the outer `<pre>`.

**Expected output snippet (HTML-ish)**

```html
<pre class="shiki has-diff">
  <code>
    <span class="line diff remove">console.log('old')</span>
    <span class="line diff add">console.log('new')</span>
    <span class="line">console.log('same')</span>
  </code>
</pre>
```

### 2) Line highlight — `highlight`

````mdx
```ts
// [!code highlight:2]
console.log("highlighted"); // Here span tag has `line`, `highlighted`
console.log("also highlighted"); // Here span tag has `line`, `highlighted`
console.log("not highlighted"); // Here span tag has `line`
```
````

**What it does**: wraps the matched lines with `class="line highlighted"` and sets `has-highlighted` on the `<pre>`.

### 3) Word highlight — `word:Hello` (scoped lines optional)

````mdx
```js
// [\!code word:Hello]
const message = "Hello world"; // span with hello has class `highlighted-word`
console.log(message); // prints Hello
```
````

**What it does**: replaces matched wo

### 3) Line focus

````mdx
```js
console.log("Not focused"); // Just span with `line`
console.log("Focused"); // [!code focus] Here span tag has `line`, `focused`
console.log("Not focused");
```
````

### 4) Error warning level

````mdx
```ts
console.log("No errors or warnings");
console.error("Error"); // [!code error] Here span tag has `line`, `highlighted`, `error`
console.warn("Warning"); // [!code warning] Here span tag has `line`, `highlighted`, `warning`
```
````
